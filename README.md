## ICSP Codec
### Introduction
This is a implementation of video codec based on C/C++. <br />
This codec is ICSP codec because I implemented this codec when I was working in the ICSP lab(https://icsp.hanyang.ac.kr).<br />
ICSP Codec has been implemented based on basic video compression theories.
The characteristics of the ICSP codec are as follows.
- 16x16 macro block unit process(One 16x16 macro block is divided by four 8x8 blocks in each compression process)
- Intra Prediction / Inter Prediction
- All Intra Prediction Mode
- DCT Transformation / Quantization
- Entropy Coding
- AVX Intrinsics Parellel Processing
- Only Supporting CIF(4:2:0)

If you have any kinds of feedback and question, please contact me.

### ICSP Codec Encoding Process
![Encoding Proces](https://user-images.githubusercontent.com/36951642/57179748-f59a9880-6ebb-11e9-9c6d-5857f45d5545.PNG)

### Intra Prediction
ICSP codec supports three-direction prediction mode in intra prediction. Vectical, Horizontal, DC mode.

![Intra prediction](https://user-images.githubusercontent.com/36951642/57229516-41cb1180-7051-11e9-83a0-da9e953b989a.png)

The green square is a reconstructed reference pixel around the current block. Intra prediction uses a reference pixel corresponding to each direction mode to generate a prediction block. DC mode generate prediction block using mean value of vertical and horizontal reference pixels. If reference pixels does not exist by some reason(first block, first row blocks, first colum blocks...), then it is replaced by integer value 127. You can set a period of a intra prediction frame in one sequcece by initialize 'intraPerid' as a integer value. For example, if you initialize 'intraPeriod' as 10 and one sequence consists of 300 frames, then every 10 frames are encoded as intra prediction mode and other frames are encoded as inter prediction.

#### All Intra Prediction Mode
ICSP Codec supports special mode, All Intra Prediction Mode. All Intra Prediction Mode encodes all of frames in one sqeuence using intra prediction mode. You can operate ICSP Codec as All Intra Prediction Mode by initialize 'intraPerid' veriable as ALL_INTRA macro value.
### Inter Prediction
ICSP Codec supports only backword prediction. That is, inter prediction blocks are generated by using only previous frame(obviously, previous frame is a reconstrunted frame). 

![image](https://user-images.githubusercontent.com/36951642/57631044-b2d27200-75d9-11e9-8997-8c8d64738c97.png)

Basically, inter prediction process is to find the location of the most similar block with current block in previous frame(fn-1). Also, current blocks are in current frame(fn). in the figure above, red block is a current block in current frame. Green block is the one closest to current block among negibor blocks around red block in previous frame. ICSP Codec uses search method as 'spiral search'.
Spiral search in ICSP codec means that search the block by round and round the current block position like sprial per a pixel unit.

![image](https://user-images.githubusercontent.com/36951642/57704034-1fae4080-769c-11e9-91ef-c10880442f18.png)

I attached the above picture for conceptual understanding about spiral search. I hope there is no misunderstanding. ICSP codec moves search block by a pixel unit and finds a similar block which has minimum SAD(Sum of Absolute Difference) between a current block and a seach block.

Up to this point, it was a conceptual explanation of the inter prediction. The inter prediction consists of motion estimation and motion compensation. I will briefly explain these two processes.

#### Motion Estimation
Simplly speaking, motion estimation is to generate a motion vector that represents the distance between a current block position and a similar block which has the smallest SAD.

![image](https://user-images.githubusercontent.com/36951642/57705527-12468580-769f-11e9-9312-a06ecd36a4b4.png)

#### Motion Compensation
In ICSP Codec, motion compensation is to make prediction blocks using motion vectors and to make differential blocks(current block - prediction block) in results. Differential blocks are used to other encode/decode process like DCT, Quantization, entropy coding process.

### DCT
Discrete Cosine Transform(DCT) decomposes a signal for time or spatial domain into frequency components such as Fourier transform.
That is, DCT transforms the image of the spatial domain into the frequency domain. When the image is transformed by DCT, it is decomposed DC(direct current) components having a frequency of 0 and sixty-three AC(alternating current) components having a frequency.
Since most image are composed of a large number of low frequency components and a few high frequency components, when DCT is applied to image, most of energy is concentrated in DC and just a few energy are widely spread to AC components having high frequency. This phenomenon is called 'Energy compaction' which is very widely used in the video compression field. <br/>
ICSP codec supports 8x8 block unit DCT. A 8x8 image block is decomposed by one DC(direct current) component which is having a frequency of 0 and sixty-three AC(alternating current) components having a relatively high frequency. 

![image](https://user-images.githubusercontent.com/36951642/58094372-7cb17580-7c0b-11e9-8887-5e9c36321c7a.png)

When the image block of the spatial domain is transformed into the frequency domain through the DCT. Most of energy us concentrated on the DC component and the low frequency AC component, and the remaining energy is widely distributed on the high frequency AC components.<br/>
the above figure is intended to explain DCT, so it is different from the exact DCT result. In fact, the image block used for DCT in the ICSP codec is a difference block and DCT result is stored as a floating type.

### Quantization
Quantization is a process of dividing a transformed block by a constant(quantization step, QStep). Through quantization, most of the AC Components which have a high frequency component have 0 value or a very small value. The more AC components with very small values, the less bits are allocated in entropy coding process, resulting in a compression efficiency increas. However, this process directly damage to image quality. The larger the QStep, the larger the loss of image quality.
ICSP codec supports independent AC and DC component quantization(QStepAC, QStepDC). Also, ICSP codec provides 1, 8 and 16 QStep.

![image](https://user-images.githubusercontent.com/36951642/58096758-bfc21780-7c10-11e9-8101-c59793486858.png)


### Entropy Coding
ZigZag reordering, Huffman coding in ICSP Codec.

### Bit Stream Syntax

### AVX Intrinsics Mode

### Contents
| Folder | description |
|---|---|
|data| test sequences |
| source | C++ source code |
